blueprint:
  name: "Philips Hue Dimmer Switch v4"
  description: "Control a dimmable light with a Philips Hue Dimmer Switch."
  domain: automation
  input:
    remote:
      name: "Philips Hue Dimmer Switch"
      selector:
        device:
          filter:
            - integration: "zha"
              manufacturer: "Signify Netherlands B.V."
              model: "RWL022"
          multiple: false
    light:
      name: Light(s)
      description: The light(s) to control
      selector:
        target:
          entity:
            - domain:
                - light
  source_url: https://github.com/urbas/ha-philips-dimmer-switch/blob/master/ha-philips-dimmer-switch-blueprint.yaml
mode: restart
max_exceeded: silent
trigger:
  - platform: event
    event_type: zha_event
    event_data:
      device_id: !input remote
action:
  - variables:
      command: "{{ trigger.event.data.command }}"
  - choose:
      # Toggle light on and off
      - conditions:
          - "{{ command == 'on_short_release' }}"
        sequence:
          - service: light.toggle
            target: !input light

      # Brightness up
      - conditions:
          - "{{ command == 'up_hold' }}"
        sequence:
          - service: light.turn_on
            target: !input light
            data:
              brightness_step_pct: 20
              transition: 1
      - conditions:
          - "{{ command == 'up_short_release' }}"
        sequence:
          - service: light.turn_on
            target: !input light
            data:
              brightness_step_pct: 5
              transition: 0

      # Brightness down
      - conditions:
          - "{{ command == 'down_hold' }}"
        sequence:
          - service: light.turn_on
            target: !input light
            data:
              brightness_step_pct: -20
              transition: 1
      - conditions:
          - "{{ command == 'down_short_release' }}"
        sequence:
          - service: light.turn_on
            target: !input light
            data:
              brightness_step_pct: -5
              transition: 0

      # Turn on to minimum brightness
      - conditions:
          - "{{ command == 'off_long_release' }}"
        sequence:
          - service: light.turn_on
            target: !input light
            data:
              brightness_pct: 1
              transition: 1

      # Turn off
      - conditions:
          - "{{ command == 'off_short_release' }}"
        sequence:
          - service: light.turn_off
            target: !input light
            data:
              transition: 1
